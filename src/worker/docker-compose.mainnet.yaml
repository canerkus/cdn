services:
  worker:
    image: subsquid/p2p-worker:1.0.0
    restart: unless-stopped
    command: p2p
    environment:
      # How many chunks are downloaded in paralel.
      # You can increase this number if you have a good internet connection.
      CONCURRENT_DOWNLOADS: 3
      # Timeout for downloading a single file.
      # Increase it if you have the "operation timed out" errors in the logs.
      S3_TIMEOUT: 60
      # The connection is dropped if no data has arrived for this time.
      S3_READ_TIMEOUT: 3
      # RPC node of the Arbitrum network
      RPC_URL: ${RPC_URL:-https://arb1.arbitrum.io/rpc}
      # RPC node of the Ethereum network
      L1_RPC_URL: ${L1_RPC_URL:-https://ethereum.publicnode.com}
      # You can set it to "info,subsquid_worker=debug" to get debug logs
      RUST_LOG: "info"

      # You probably shouldn't change the values below
      SCHEDULER_ID: 12D3KooWS5N8ygU6fRy4EZtzdHf4QZnkCaZrwCha9eYKH3LwNvsP
      LOGS_COLLECTOR_ID: 12D3KooWFnRhNqgsKtsDDhsozaWuyrTvtQA2Eu4XWvSPRd4UZynd
      P2P_LISTEN_ADDRS: /ip4/0.0.0.0/udp/${LISTEN_PORT:?}/quic-v1
      P2P_PUBLIC_ADDRS: ${PUBLIC_ADDR}
      BOOT_NODES: >
        12D3KooW9tLMANc4Vnxp27Ypyq8m8mUv45nASahj3eSnMbGWSk1b /dns4/mainnet.subsquid.io/udp/22445/quic-v1,
        12D3KooWEhPC7rsHAcifstVwJ3Cj55sWn7zXWuHrtAQUCGhGYnQz /dns4/mainnet.subsquid.io/udp/22446/quic-v1,
        12D3KooWS5N8ygU6fRy4EZtzdHf4QZnkCaZrwCha9eYKH3LwNvsP /dns4/mainnet.subsquid.io/udp/32445/quic-v1
      NETWORK: mainnet
      DATA_DIR: /app/data
      KEY_PATH: /app/key
      SENTRY_DSN: https://f97ffef7e96eb533d4c527ce62e4cfbf@o1149243.ingest.us.sentry.io/4507056936779776
    user: "${UID}:${GID}"
    volumes:
      - ${DATA_DIR:?}:/app/data
      - ${KEY_PATH:?}:/app/key:ro
    ports:
      - "${PROMETHEUS_PORT:-9090}:8000"
      - "${LISTEN_PORT:?}:${LISTEN_PORT:?}/udp"
    deploy:
      resources:
        limits:
          memory: 16G